<div class="p-grid">
  <h2 class="cabecalho">
    Minhas Experiências
  </h2>
</div>
<div class="p-grid p-mt-6">
  <div class="p-col-12">
    <button pButton class="botao-novo" label="Novo" (click)="navegarRotaIncluir()" title="Incluir Experiência">
      <i class="pi pi-plus p-mr-1"></i>
    </button>
    <button pButton class="botao-pesquisar" label="Todos" (click)="buscarTodos()"
            title="Pesquisar Todas as Minhas Experiências">
      <i class="pi pi-search p-mr-1"></i>
    </button>
  </div>
</div>
<div class="p-grid p-mt-6 p-ai-center">
  <div class="p-col-12">
    <p-card class="card-table">
      <p-table #tabela [columns]="cols" [value]="demandantes.content" [autoLayout]="true"
               [resizableColumns]="true" [paginator]="true" [rows]="rows" [totalRecords]="demandantes.totalElements"
               sortMode="multiple" [rowsPerPageOptions]="[20,30,50]">

        <ng-template pTemplate="header" let-columns>
          <tr>
            <th *ngFor="let col of columns" [pSortableColumn]="col.sortField" (click)="search()">
              {{col.header}}
              <p-sortIcon [field]="col.sortField"></p-sortIcon>
            </th>
            <th>
              Ações
            </th>
          </tr>
          <tr>
            <th class="filtros">
              <p-columnFilter field="numDemandante" matchMode="in" [showMenu]="false">
                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                  <input type="text" pInputText placeholder="Selecione" field="label"
                         [(ngModel)]="demandanteFiltro.numDemandante" (change)="listarComFiltro()" />
                </ng-template>
              </p-columnFilter>
            </th>
            <th class="filtros">
              <p-columnFilter field="assunto" matchMode="in" [showMenu]="false">
                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                  <p-autoComplete [(ngModel)]="demandanteFiltro.titulo"
                                  [suggestions]="assuntoSelecionado" field="label" placeholder="Selecione"
                                  (completeMethod)="carregarSelectAssunto(demandanteFiltro.titulo)"
                                  (onSelect)="listarComFiltro()">
                  </p-autoComplete>
                </ng-template>
              </p-columnFilter>
            </th>
            <th class="filtros">
              <p-columnFilter field="categorias" matchMode="in" [showMenu]="false">
                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                  <p-autoComplete [(ngModel)]="demandanteFiltro.categorias"
                                  [suggestions]="categoriaSelecionado" field="label" placeholder="Selecione"
                                  (completeMethod)="carregarSelectCategoria(demandanteFiltro.categorias)"
                                  (onSelect)="listarComFiltro()">
                  </p-autoComplete>
                </ng-template>
              </p-columnFilter>
            </th>
            <th class="filtros">
              <p-columnFilter field="referencias" matchMode="in" [showMenu]="false">
                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                  <p-autoComplete [(ngModel)]="demandanteFiltro.referencias"
                                  [suggestions]="referenciaSelecionado" field="label" placeholder="Selecione"
                                  (completeMethod)="carregarSelectReferencia(demandanteFiltro.referencias)"
                                  (onSelect)="listarComFiltro()">
                  </p-autoComplete>
                </ng-template>
              </p-columnFilter>
            </th>
            <th class="filtros">
              <p-columnFilter field="dataInclusao" matc hMode="in" [showMenu]="false">
                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                  <p-calendar [(ngModel)]="demandanteFiltro.criadoEm" [monthNavigator]="true"
                              [placeholder]="'DD/MM/AAAA'" dateFormat="dd/mm/yy" [yearNavigator]="true"
                              yearRange="2021:2100" inputId="dataInclusao" placeholder="Selecione"
                              (onSelect)="listarComFiltro()">
                  </p-calendar>
                </ng-template>
              </p-columnFilter>
            </th>
            <th class="filtros">
              <p-columnFilter field="militarResponsavel" matchMode="in" [showMenu]="false">
                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                  <p-autoComplete [(ngModel)]="demandanteFiltro.militarResponsavel"
                                  [suggestions]="responsavelSelecionado" field="label" placeholder="Selecione"
                                  (completeMethod)="carregarSelectResponsavel(demandanteFiltro.militarResponsavel)"
                                  (onSelect)="listarComFiltro()">
                  </p-autoComplete>
                </ng-template>
              </p-columnFilter>
            </th>
            <th class="filtros">

              <p-columnFilter field="situacao" matchMode="in" [showMenu]="false">
                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                  <p-dropdown [(ngModel)]="demandanteFiltro.situacao" [options]="this.situacao"
                              optionValue="value" (onChange)="listarComFiltro()" optionLabel="label">
                    <ng-template let-option pTemplate="item">
                      <span class="p-ml-1">{{option.label}}</span>
                    </ng-template>
                  </p-dropdown>
                </ng-template>
              </p-columnFilter>

            </th>
            <th class="filtros"></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-demandante>
          <tr [pSelectableRow]="demandante">
            <td>{{demandante.numDemandante}}</td>
            <td>{{demandante.titulo}}</td>
            <td>{{demandante.categorias}}</td>
            <td>{{demandante.referencias}}</td>
            <td>{{demandante.criadoEm|date:'dd/MM/y'}}</td>
            <td>
              <strong>{{(demandante.militarResponsavel)}}</strong>
            </td>
            <td>{{situacaoMapper[demandante.situacao]}}</td>
            <td class="acoes">
              <app-menu-acoes-table #menuAcoes [menuAcoes]="menuAcoes" [menuSelected]="menuSelecionado"
                                    (click)="preencheAcoesMenu(demandante, menuAcoes)" [acoes]="acoesMenu"
                                    [data]="demandante">
              </app-menu-acoes-table>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td class="mensagem-vazia" [attr.colspan]="9">Nenhum registro encontrado</td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>
</div>
<p-confirmDialog></p-confirmDialog>
<p-toast [key]="ERRO_TOAST"></p-toast>
